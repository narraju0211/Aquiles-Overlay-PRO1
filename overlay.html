<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aquiles Placar PRO - Overlay</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Evita barras de rolagem */
            background-color: transparent; /* A overlay geralmente não tem fundo visível */
            color: #ecf0f1; /* Cor padrão do texto */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        #scoreboard-container {
            position: relative; /* Para posicionar elementos internos */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 1280px; /* Largura máxima típica para overlays de streaming */
            height: 100%; /* Pode ajustar conforme seu design */
        }

        /* Estilos do Placar Principal (ajuste conforme seu design real da overlay) */
        .team-display {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }

        .team-name {
            font-size: 2.5em;
            font-weight: 700;
            color: #f39c12; /* Cor de destaque */
            transition: opacity 0.3s ease;
        }

        .team-score {
            font-family: 'Roboto Mono', monospace;
            font-size: 3em;
            font-weight: 700;
            color: #3498db; /* Cor do placar */
        }

        .team-logo {
            height: 80px; /* Ajuste o tamanho padrão do escudo */
            width: 80px;
            object-fit: contain;
            /* Garante que o escudo fique visível mesmo em temas escuros */
            background-color: rgba(255, 255, 255, 0.8); 
            border-radius: 5px;
            padding: 2px;
            transition: opacity 0.3s ease;
        }

        #center-logo {
            position: absolute;
            top: 20px; /* Ajuste a posição */
            left: 50%;
            transform: translateX(-50%);
            height: 100px; /* Tamanho da logo central */
            width: auto;
            object-fit: contain;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
            padding: 5px;
            z-index: 10; /* Para ficar acima de outros elementos se necessário */
        }

        /* --- Estilos para Pênaltis (as bolinhas) --- */
        .penalty-container-wrapper {
            position: absolute; /* Posição absoluta para o grupo de pênaltis */
            top: 50%; /* Ajuste para o centro vertical, ou outro ponto */
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 40px; /* Espaço entre os contêineres dos dois times */
            z-index: 2000; /* Garante que fique acima de quase tudo */
        }

        .penalty-team-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background-color: rgba(44, 62, 80, 0.8); /* Fundo semi-transparente para o container de pênaltis */
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            min-width: 200px; /* Largura mínima para o container de pênaltis */
        }
        
        .penalty-team-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #f1c40f;
            margin-bottom: 5px;
        }

        .penalty-dots {
            display: flex;
            flex-wrap: wrap; /* Para quebrar linha se tiver muitas bolinhas */
            gap: 8px; /* Espaço entre as bolinhas */
            justify-content: center;
        }

        .penalty-dot {
            width: 25px; /* Tamanho da bolinha */
            height: 25px;
            border-radius: 50%; /* Para ser uma bolinha */
            border: 2px solid #ecf0f1; /* Borda branca */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .penalty-dot.goal {
            background-color: #27ae60; /* Verde para gol */
        }

        .penalty-dot.miss {
            background-color: #e74c3c; /* Vermelho para erro */
        }

        /* --- Visibilidade --- */
        .hidden {
            display: none !important;
        }

        /* Animação de Gol */
        @keyframes goalHighlight {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 1; filter: drop-shadow(0 0 15px #f1c40f); }
            100% { transform: scale(1); opacity: 1; }
        }

        .goal-animation {
            animation: goalHighlight 1.5s ease-out; /* Duração menor para destaque rápido */
        }
    </style>
</head>
<body>
    <div id="scoreboard-container">
        <img id="center-logo" src="" alt="Logo Central" class="hidden">

        <div class="team-display">
            <img id="team1EscudoOverlay" src="" alt="Escudo Time 1" class="team-logo hidden">
            <h2 id="team1NameOverlay" class="team-name">TIME 1</h2>
            <span id="score1Overlay" class="team-score">0</span>
        </div>

        <div class="team-display">
            <img id="team2EscudoOverlay" src="" alt="Escudo Time 2" class="team-logo hidden">
            <h2 id="team2NameOverlay" class="team-name">TIME 2</h2>
            <span id="score2Overlay" class="team-score">0</span>
        </div>

        <div id="cardsDisplay" style="margin-top: 20px;">
            </div>

        <div style="margin-top: 20px; font-size: 1.8em; font-weight: 700; color: #f1c40f;">
            <span id="displayPeriodOverlay">1º T</span> - <span id="displayTimerOverlay">00:00</span>
        </div>

        <div id="penaltyContainerWrapper" class="penalty-container-wrapper hidden">
            <div id="penaltyTeam1Container" class="penalty-team-container">
                <h3 class="penalty-team-title">Time 1</h3>
                <div id="penaltyDots1" class="penalty-dots"></div>
            </div>
            <div id="penaltyTeam2Container" class="penalty-team-container">
                <h3 class="penalty-team-title">Time 2</h3>
                <div id="penaltyDots2" class="penalty-dots"></div>
            </div>
        </div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // ** SUAS CONFIGURAÇÕES DO FIREBASE ESTÃO AQUI (COPIE DO SEU CONTROLADOR) **
        const firebaseConfig = {
          apiKey: "AIzaSyAFp_iujrtqjiTU5yq2yNSBIpwgjQZZyns",
          authDomain: "aquilesplacarpro.firebaseapp.com",
          databaseURL: "https://aquilesplacarpro-default-rtdb.firebaseio.com",
          projectId: "aquilesplacarpro",
          messagingSenderId: "922321609151",
          appId: "1:922321609151:web:ba51f5b21b322cf0a4c10a"
        };

        // Obtenha o Narrator ID da URL (crucial para conectar)
        const urlParams = new URLSearchParams(window.location.search);
        const NARRATOR_ID = urlParams.get('narratorId');

        if (!NARRATOR_ID) {
            document.body.innerText = "Erro: Narrator ID não fornecido na URL. Verifique o link do controlador.";
            throw new Error("Narrator ID é necessário.");
        }

        // Inicializa o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = app.database();
        const overlayStateRef = database.ref(`narrators/${NARRATOR_ID}/overlayState`);

        // Elementos da UI da Overlay
        const scoreboardContainer = document.getElementById('scoreboard-container');
        const team1NameEl = document.getElementById('team1NameOverlay');
        const team2NameEl = document.getElementById('team2NameOverlay');
        const score1El = document.getElementById('score1Overlay');
        const score2El = document.getElementById('score2Overlay');
        const team1EscudoEl = document.getElementById('team1EscudoOverlay');
        const team2EscudoEl = document.getElementById('team2EscudoOverlay');
        const centerLogoEl = document.getElementById('center-logo');

        const displayTimerEl = document.getElementById('displayTimerOverlay');
        const displayPeriodEl = document.getElementById('displayPeriodOverlay');

        // Elementos de Pênalti
        const penaltyContainerWrapper = document.getElementById('penaltyContainerWrapper');
        const penaltyDots1 = document.getElementById('penaltyDots1');
        const penaltyDots2 = document.getElementById('penaltyDots2');

        const periodNames = {
            0: 'Parado', 1: '1º T', 2: '2º T', 3: 'Prorrog', 4: 'Int', 5: 'T. Extra'
        };

        function formatTime(s) {
            const min = String(Math.floor(s / 60)).padStart(2, '0');
            const sec = String(s % 60).padStart(2, '0');
            return `${min}:${sec}`;
        }

        // Função para renderizar as bolinhas de pênalti
        function renderPenalties(penaltiesArray, containerElement) {
            containerElement.innerHTML = ''; // Limpa as bolinhas existentes
            penaltiesArray.forEach(status => {
                const dot = document.createElement('div');
                dot.classList.add('penalty-dot');
                if (status === 'goal') {
                    dot.classList.add('goal');
                } else if (status === 'miss') {
                    dot.classList.add('miss');
                }
                containerElement.appendChild(dot);
            });
        }

        // Listener principal para o Firebase (atualiza a overlay)
        overlayStateRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                // Controlar visibilidade da Overlay inteira
                scoreboardContainer.style.opacity = data.isVisible ? '1' : '0';
                scoreboardContainer.style.transition = 'opacity 0.5s ease-in-out';

                // Atualizar Placar e Nomes dos Times (ou abreviações)
                score1El.innerText = data.placar['1'];
                score2El.innerText = data.placar['2'];

                // Ativar Animação de Gol
                if (data.activeAnimation && data.activeAnimation.type === 'goalAnimation') {
                    if (data.activeAnimation.team === '1') {
                        score1El.classList.add('goal-animation');
                        setTimeout(() => score1El.classList.remove('goal-animation'), 3500);
                    } else if (data.activeAnimation.team === '2') {
                        score2El.classList.add('goal-animation');
                        setTimeout(() => score2El.classList.remove('goal-animation'), 3500);
                    }
                }

                // Atualizar Escudos
                if (data.escudo1) {
                    team1EscudoEl.src = data.escudo1;
                    team1EscudoEl.classList.remove('hidden');
                } else {
                    team1EscudoEl.classList.add('hidden');
                }
                if (data.escudo2) {
                    team2EscudoEl.src = data.escudo2;
                    team2EscudoEl.classList.remove('hidden');
                } else {
                    team2EscudoEl.classList.add('hidden');
                }

                // Atualizar Logo Central
                if (data.logoOverlay) {
                    centerLogoEl.src = data.logoOverlay;
                    centerLogoEl.classList.remove('hidden');
                } else {
                    centerLogoEl.classList.add('hidden');
                }

                // Ajustar Tamanho das Imagens
                const imageSize = data.imageSize || 50; // Padrão se não houver
                team1EscudoEl.style.height = `${imageSize}px`;
                team1EscudoEl.style.width = `${imageSize}px`;
                team2EscudoEl.style.height = `${imageSize}px`;
                team2EscudoEl.style.width = `${imageSize}px`;
                // Ajuste a logo central proporcionalmente se desejar, ou defina um tamanho fixo
                centerLogoEl.style.height = `${imageSize * 2}px`; // Exemplo: logo central 2x maior
                centerLogoEl.style.width = 'auto';


                // Lógica para Pênaltis
                if (data.penaltyModeActive) {
                    team1NameEl.classList.add('hidden'); // Esconde nome do time
                    team2NameEl.classList.add('hidden'); // Esconde nome do time
                    score1El.classList.add('hidden'); // Esconde placar
                    score2El.classList.add('hidden'); // Esconde placar
                    team1EscudoEl.classList.add('hidden'); // Esconde escudo
                    team2EscudoEl.classList.add('hidden'); // Esconde escudo
                    centerLogoEl.classList.add('hidden'); // Esconde logo central

                    penaltyContainerWrapper.classList.remove('hidden'); // Mostra contêiner de pênaltis
                    renderPenalties(data.penalties['1'], penaltyDots1);
                    renderPenalties(data.penalties['2'], penaltyDots2);
                } else {
                    team1NameEl.classList.remove('hidden'); // Mostra nome do time
                    team2NameEl.classList.remove('hidden'); // Mostra nome do time
                    score1El.classList.remove('hidden'); // Mostra placar
                    score2El.classList.remove('hidden'); // Mostra placar
                    if (data.escudo1) team1EscudoEl.classList.remove('hidden'); // Re-mostra escudo
                    if (data.escudo2) team2EscudoEl.classList.remove('hidden'); // Re-mostra escudo
                    if (data.logoOverlay) centerLogoEl.classList.remove('hidden'); // Re-mostra logo

                    penaltyContainerWrapper.classList.add('hidden'); // Esconde contêiner de pênaltis

                    // Nomes dos Times (ou abreviações)
                    team1NameEl.innerText = data.nome1 || data.nomeAbbr1;
                    team2NameEl.innerText = data.nome2 || data.nomeAbbr2;
                }

                // Cronômetro e Período
                displayTimerEl.innerText = formatTime(data.seconds);
                displayPeriodEl.innerText = periodNames[data.currentPeriod] || 'N/A';

                // Lógica do cronômetro (não no Firebase, mas na própria overlay para suavidade)
                if (data.timerRunning && !window.timerInterval) {
                    window.timerInterval = setInterval(() => {
                        // A overlay NÃO DEVE alterar 'seconds' no Firebase para evitar loops.
                        // Ela apenas mostra o que o controlador envia.
                    }, 1000); // Intervalo de 1 segundo (a cada segundo, a UI será atualizada pelo Firebase)
                } else if (!data.timerRunning && window.timerInterval) {
                    clearInterval(window.timerInterval);
                    window.timerInterval = null;
                }

                // Temas e Cores
                // Aqui você adicionaria a lógica para aplicar temas, opacidade e cor da fonte.
                // Isso pode ser feito adicionando classes CSS ao body ou scoreboard-container,
                // ou mudando propriedades CSS diretamente com JS.
                // Exemplo:
                // scoreboardContainer.style.backgroundColor = `rgba(52, 73, 94, ${data.placarOpacity / 100})`;
                // scoreboardContainer.style.color = data.fontColor;
                // Dependendo do 'placarThemeIndex' ou 'currentLayoutIndex', você pode carregar estilos diferentes.
            }
        });
    </script>
</body>
</html>
