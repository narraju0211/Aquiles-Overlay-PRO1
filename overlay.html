<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Aquiles Overlay PRO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --placar-bg-rgb: 34, 34, 34;
      --placar-opacity: 0.9;
      --placar-text: white;
      --placar-border: #555;
      --placar-timer-color: #0ff;
      --highlight-color: #0ff; 
      --animation-duration: 0.5s; 
    }

    body {
      margin: 0;
      padding: 0;
      overflow: hidden; 
      background-color: rgba(0, 0, 0, 0); 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start; 
      height: 100vh;
      width: 100vw;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      position: relative;
      top: 50px; 
      display: flex;
      align-items: center;
      background-color: rgba(var(--placar-bg-rgb), var(--placar-opacity)); 
      border: 2px solid var(--placar-border);
      border-radius: 15px;
      padding: 10px 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
      color: var(--placar-text);
      font-weight: bold;
      font-size: 4em; 
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.5s ease-out, transform 0.5s ease-out, background-color 0.5s ease, border-color 0.5s ease, color 0.5s ease;
      animation: fadeIn 0.5s ease-out forwards;
      will-change: transform, opacity;
      white-space: nowrap; 
    }

    .container.hidden {
        opacity: 0 !important;
        transform: translateY(-50px) !important;
        pointer-events: none; 
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .team {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 0 10px;
    }

    .team-name-abbr {
        font-size: 0.4em; 
        margin-top: 5px; 
        text-transform: uppercase;
        letter-spacing: 1px;
        color: rgba(var(--placar-text), 0.8);
    }
    .score {
      font-size: 1.5em; 
      min-width: 50px; 
      text-align: center;
      color: var(--highlight-color);
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
    }

    .separator {
      margin: 0 20px;
      font-size: 1.2em;
      color: var(--placar-text);
    }

    .logo-overlay {
      height: 80px; 
      width: auto;
      margin: 0 20px;
      transition: opacity 0.3s ease-out;
    }

    .timer-container {
      position: absolute;
      top: -45px; 
      background-color: rgba(var(--placar-bg-rgb), 1); 
      padding: 5px 15px;
      border-radius: 10px;
      font-size: 0.6em; 
      color: var(--placar-timer-color);
      border: 1px solid var(--placar-border);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
      min-width: 120px; 
      text-align: center;
      letter-spacing: 1px;
    }

    .timer-period {
        font-size: 0.7em; 
        color: rgba(var(--placar-timer-color), 0.8); 
    }

    .escudo {
      height: 70px; 
      width: auto;
      object-fit: contain;
    }

    .cards-container {
        position: absolute;
        bottom: -35px; 
        display: flex;
        gap: 10px; 
        background-color: rgba(var(--placar-bg-rgb), 0.95);
        padding: 5px 15px;
        border-radius: 10px;
        border: 1px solid var(--placar-border);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    }
    .card-group {
        display: flex;
        align-items: center;
        gap: 5px; 
    }
    .card-icon {
        width: 20px; 
        height: 28px; 
        border-radius: 3px;
        border: 1px solid rgba(0,0,0,0.2);
    }
    .card-icon.yellow { background-color: #ffc107; }
    .card-icon.red { background-color: #dc3545; }
    .card-count {
        font-size: 0.5em; 
        color: var(--placar-text);
        font-weight: bold;
    }

    /* Animação de Gol */
    @keyframes goalBounce {
        0%, 100% { transform: translateY(0); }
        25% { transform: translateY(-10px); }
        50% { transform: translateY(5px); }
        75% { transform: translateY(-5px); }
    }
    .container.goal-animation .score {
        animation: goalBounce var(--animation-duration) ease-out;
        transform-origin: bottom;
    }

    /* Modo Pênaltis */
    .penalties-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        gap: 30px; 
        background-color: rgba(var(--placar-bg-rgb), 0.98);
        border: 2px solid var(--placar-border);
        border-radius: 15px;
        padding: 20px 30px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.8);
        color: var(--placar-text);
        font-weight: bold;
        z-index: 10; 
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.5s ease-out, visibility 0.5s;
    }
    .penalties-container.active {
        opacity: 1;
        visibility: visible;
    }
    .penalty-team {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }
    .penalty-score-label {
        font-size: 0.8em;
        margin-bottom: 5px;
        color: var(--highlight-color);
    }
    .penalty-marks {
        display: flex;
        gap: 8px; 
    }
    .penalty-mark {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background-color: #555; 
        border: 2px solid #777;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
    }
    .penalty-mark.green {
        background-color: #28a745; 
        border-color: #218838;
    }
    .penalty-mark.red {
        background-color: #dc3545; 
        border-color: #c82333;
    }
  </style>
</head>
<body>
  <div class="container" id="overlayContainer">
    <div class="team team1">
      <img src="" alt="Escudo Time 1" class="escudo" id="escudo1">
      <span class="team-name-abbr" id="nomeAbbr1">T1</span>
      <span class="score" id="placar1">0</span>
    </div>

    <img src="" alt="Sua Logo" class="logo-overlay" id="logoOverlay">

    <div class="team team2">
      <span class="score" id="placar2">0</span>
      <span class="team-name-abbr" id="nomeAbbr2">T2</span>
      <img src="" alt="Escudo Time 2" class="escudo" id="escudo2">
    </div>

    <div class="timer-container">
      <div id="timer">00:00</div>
      <div class="timer-period" id="period">1º T</div>
    </div>

    <div class="cards-container" id="cardsContainer">
        <div class="card-group team1-cards">
            <div class="card-icon yellow"></div>
            <span class="card-count" id="cards1Yellow">0</span>
            <div class="card-icon red"></div>
            <span class="card-count" id="cards1Red">0</span>
        </div>
        <div class="card-group team2-cards">
            <div class="card-icon yellow"></div>
            <span class="card-count" id="cards2Yellow">0</span>
            <div class="card-icon red"></div>
            <span class="card-count" id="cards2Red">0</span>
        </div>
    </div>
  </div>

  <div class="penalties-container" id="penaltiesContainer">
      <div class="penalty-team team1-penalties">
          <span class="penalty-score-label" id="penaltyScore1">Pênaltis T1: 0</span>
          <div class="penalty-marks" id="penaltyMarks1">
              </div>
      </div>
      <div class="penalty-team team2-penalties">
          <span class="penalty-score-label" id="penaltyScore2">Pênaltis T2: 0</span>
          <div class="penalty-marks" id="penaltyMarks2">
              </div>
      </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // ** SEU FIREBASE CONFIG ESTÁ AQUI **
    const firebaseConfig = {
      apiKey: "AIzaSyAFp_iujrtqjiTU5yq2yNSBIpwgjQZZyns",
      authDomain: "aquilesplacarpro.firebaseapp.com",
      databaseURL: "https://aquilesplacarpro-default-rtdb.firebaseio.com",
      projectId: "aquilesplacarpro",
      storageBucket: "aquilesplacarpro.firebasestorage.app",
      messagingSenderId: "922321609151",
      appId: "1:922321609151:web:ba51f5b21b322cf0a4c10a"
    };

    // Inicialize o Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = app.database();

    // --- MUDANÇA CRÍTICA AQUI: Definição do ID do Jogo (Canal) ---
    const urlParams = new URLSearchParams(window.location.search);
    // 'channel' é o nome do parâmetro na URL (ex: overlay.html?channel=narraju)
    const gameId = urlParams.get('channel') || 'default_channel'; 
    console.log(`Overlay: Ativa para o canal: ${gameId}`);

    // Referência do Firebase para o canal específico
    const gameRef = database.ref('channels').child(gameId); 

    const placar1Element = document.getElementById('placar1');
    const placar2Element = document.getElementById('placar2');
    const nomeAbbr1Element = document.getElementById('nomeAbbr1');
    const nomeAbbr2Element = document.getElementById('nomeAbbr2');
    const escudo1Element = document.getElementById('escudo1');
    const escudo2Element = document.getElementById('escudo2');
    const logoOverlayElement = document.getElementById('logoOverlay');
    const timerElement = document.getElementById('timer');
    const periodElement = document.getElementById('period');
    const overlayContainer = document.getElementById('overlayContainer');
    const cards1YellowElement = document.getElementById('cards1Yellow');
    const cards1RedElement = document.getElementById('cards1Red');
    const cards2YellowElement = document.getElementById('cards2Yellow');
    const cards2RedElement = document.getElementById('cards2Red');
    const penaltiesContainer = document.getElementById('penaltiesContainer');
    const penaltyScore1Element = document.getElementById('penaltyScore1');
    const penaltyScore2Element = document.getElementById('penaltyScore2');
    const penaltyMarks1Element = document.getElementById('penaltyMarks1');
    const penaltyMarks2Element = document.getElementById('penaltyMarks2');

    let overlayState = {
      placar: { '1': 0, '2': 0 },
      cards: { '1': { 'amarelo': 0, 'vermelho': 0 }, '2': { 'amarelo': 0, 'vermelho': 0 } },
      penalties: { '1': [], '2': [] },
      seconds: 0,
      timerRunning: false,
      placarThemeIndex: 0,
      placarOpacity: 90, 
      penaltyModeActive: false,
      activeAnimation: null, 
      currentPeriod: 1,
      nome1: '',
      nome2: '',
      nomeAbbr1: 'T1', 
      nomeAbbr2: 'T2', 
      escudo1: '',
      escudo2: '',
      logoOverlay: '', 
      isVisible: true
    };

    const placarThemes = [
      { rgb: '34, 34, 34', text: 'white', border: '#555', timerColor: '#0ff' }, 
      { rgb: '0, 123, 255', text: 'white', border: '#0056b3', timerColor: '#fff' },
      { rgb: '40, 167, 69', text: 'white', border: '#218838', timerColor: '#fff' },
      { rgb: '220, 53, 69', text: 'white', border: '#c82333', timerColor: '#fff' },
      { rgb: '255, 193, 7', text: 'black', border: '#e0a800', timerColor: '#333' }
    ];

    const periodNames = {
        0: 'Parado',
        1: '1º T', 
        2: '2º T',
        3: 'Prorrog', 
        4: 'Int', 
        5: 'T. Extra' 
    };

    document.addEventListener('DOMContentLoaded', () => {
      console.log("Overlay: DOMContentLoaded - Configurando listener Firebase.");
      // --- MUDANÇA AQUI: Usando gameRef para ouvir dados do canal específico ---
      gameRef.on('value', (snapshot) => { 
        if (snapshot.exists()) {
          const data = snapshot.val();
          console.log("Overlay: Dados recebidos do Firebase:", data);
          Object.assign(overlayState, data);
          updateOverlay();
          applyTheme();
        } else {
          console.log(`Overlay: Nenhum dado no Firebase para o canal '${gameId}'. Exibindo padrões.`);
        }
      });
    });

    function formatTime(totalSeconds) {
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function updateOverlay() {
      placar1Element.textContent = overlayState.placar['1'];
      placar2Element.textContent = overlayState.placar['2'];
      nomeAbbr1Element.textContent = overlayState.nomeAbbr1;
      nomeAbbr2Element.textContent = overlayState.nomeAbbr2;
      escudo1Element.src = overlayState.escudo1 || ''; 
      escudo2Element.src = overlayState.escudo2 || ''; 
      logoOverlayElement.src = overlayState.logoOverlay || '';

      timerElement.textContent = formatTime(overlayState.seconds);
      periodElement.textContent = periodNames[overlayState.currentPeriod] || 'N/A';

      cards1YellowElement.textContent = overlayState.cards['1'] ? overlayState.cards['1']['amarelo'] : 0;
      cards1RedElement.textContent = overlayState.cards['1'] ? overlayState.cards['1']['vermelho'] : 0;
      cards2YellowElement.textContent = overlayState.cards['2'] ? overlayState.cards['2']['amarelo'] : 0;
      cards2RedElement.textContent = overlayState.cards['2'] ? overlayState.cards['2']['vermelho'] : 0;

      if (overlayState.activeAnimation === 'goalAnimation') {
          overlayContainer.classList.add('goal-animation');
      } else {
          overlayContainer.classList.remove('goal-animation');
      }

      if (overlayState.isVisible) {
          overlayContainer.classList.remove('hidden');
      } else {
          overlayContainer.classList.add('hidden');
      }

      if (overlayState.penaltyModeActive) {
          penaltiesContainer.classList.add('active');
          renderPenalties();
      } else {
          penaltiesContainer.classList.remove('active');
      }
    }

    function applyTheme() {
        const theme = placarThemes[overlayState.placarThemeIndex];
        document.documentElement.style.setProperty('--placar-bg-rgb', theme.rgb);
        document.documentElement.style.setProperty('--placar-text', theme.text);
        document.documentElement.style.setProperty('--placar-border', theme.border);
        document.documentElement.style.setProperty('--placar-timer-color', theme.timerColor);
        document.documentElement.style.setProperty('--placar-opacity', overlayState.placarOpacity / 100);
    }

    function renderPenalties() {
        let converted1 = 0;
        penaltyMarks1Element.innerHTML = '';
        for (let i = 0; i < 5; i++) { 
            const mark = document.createElement('div');
            mark.classList.add('penalty-mark');
            if (overlayState.penalties['1'] && overlayState.penalties['1'][i]) {
                mark.classList.add(overlayState.penalties['1'][i]);
                if (overlayState.penalties['1'][i] === 'green') converted1++;
            }
            penaltyMarks1Element.appendChild(mark);
        }
        penaltyScore1Element.textContent = `Pênaltis T1: ${converted1}`;

        let converted2 = 0;
        penaltyMarks2Element.innerHTML = '';
        for (let i = 0; i < 5; i++) { 
            const mark = document.createElement('div');
            mark.classList.add('penalty-mark');
            if (overlayState.penalties['2'] && overlayState.penalties['2'][i]) {
                mark.classList.add(overlayState.penalties['2'][i]);
                if (overlayState.penalties['2'][i] === 'green') converted2++;
            }
            penaltyMarks2Element.appendChild(mark);
        }
        penaltyScore2Element.textContent = `Pênaltis T2: ${converted2}`;
    }
  </script>
</body>
</html>
