<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Aquiles Overlay PRO - Overlay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --placar-bg-rgb: 34, 34, 34;
      --placar-opacity: 0.9;
      --placar-text: white;
      --placar-border: #555;
      --placar-timer-color: #0ff;
      --highlight-color: #0ff;
    }

    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: transparent; /* Permite ver o fundo da transmissão */
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start; /* Alinha o placar no topo da overlay */
      width: 100vw;
      height: 100vh;
    }

    /* Container principal da overlay que controla a visibilidade e a posição */
    .visual-overlay-container {
      position: absolute; /* Posição absoluta dentro do body da overlay */
      top: 20px; /* Distância do topo da tela */
      left: 50%;
      transform: translateX(-50%); /* Centraliza horizontalmente */
      width: 100%;
      max-width: 900px; /* Largura máxima para o placar */
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
      opacity: 1;
      visibility: visible;
      background-color: transparent; /* Apenas o placar tem background */
      z-index: 2;
    }

    .visual-overlay-container.hidden-display {
      opacity: 0;
      visibility: hidden;
      pointer-events: none; /* Não interage com o mouse quando oculto */
    }

    .placar {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(var(--placar-bg-rgb), var(--placar-opacity)); 
      padding: 5px 15px; 
      border-radius: 12px;
      width: 100%;
      box-sizing: border-box;
      border: 1px solid var(--placar-border);
      color: var(--placar-text);
      position: relative; 
      overflow: hidden; 
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    }

    .placar-main-line {
      display: flex;
      align-items: center;
      justify-content: center; 
      width: 100%;
      gap: 5px; 
      flex-wrap: nowrap;
      padding: 5px 0;
    }

    .placar-group {
      display: flex;
      align-items: center;
      gap: 5px; 
      flex-shrink: 0; 
    }

    .logo-central {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0; 
      padding: 0 10px; 
      min-width: 60px; 
    }
    .logo-central img {
      width: 60px; 
      height: 60px;
      object-fit: contain;
      filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.6));
    }

    .escudo {
      width: 45px; 
      height: 45px;
      object-fit: contain;
      flex-shrink: 0;
      filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.5));
    }
    .placar-numero {
      font-size: 42px; 
      font-weight: bold;
      margin: 0 3px; 
      min-width: 50px; 
      text-align: center;
      flex-shrink: 0;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.6);
    }

    .team-name-abbr {
      font-size: 28px; 
      font-weight: bold;
      color: var(--placar-text);
      background: rgba(0, 0, 0, 0.4);
      padding: 4px 8px;
      border-radius: 4px;
      text-transform: uppercase; 
      flex-shrink: 0;
      white-space: nowrap;
    }

    #cronometro,
    #periodoDisplay {
      font-size: 24px; 
      font-weight: bold;
      color: var(--placar-timer-color);
      background: rgba(0, 0, 0, 0.6);
      padding: 4px 10px;
      border-radius: 6px;
      white-space: nowrap;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.6);
      flex-shrink: 0;
    }
    #periodoDisplay {
        font-size: 20px; 
        background: rgba(0, 0, 0, 0.4);
        color: var(--placar-text);
    }

    .placar-cards-line {
      display: flex;
      align-items: center;
      justify-content: center; 
      width: 100%;
      margin-top: 8px; 
      padding-top: 8px; 
      border-top: 1px solid rgba(255, 255, 255, 0.15); 
      flex-wrap: nowrap;
      gap: 40px; 
      padding-bottom: 5px; 
    }

    .cards-display {
      display: flex;
      min-height: 20px;
      align-items: center;
      justify-content: center;
      width: unset;
      flex-shrink: 0;
      gap: 5px; 
    }
    .card-indicator {
      width: 20px; 
      height: 20px;
      border-radius: 4px; 
      margin: 0;
      border: 1px solid #777;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    .card-indicator.yellow-card { background-color: #ffc107; }
    .card-indicator.red-card { background-color: #dc3545; }

    .penalty-shootout-placar {
        display: none;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        gap: 15px;
        padding: 10px 0;
    }
    .penalty-shootout-placar.active {
        display: flex;
    }
    .penalty-team-display {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        min-width: 150px;
        justify-content: center;
        flex-grow: 1;
    }
    .penalty-team-display .team-name-display {
        font-size: 18px; 
        font-weight: bold;
        margin-top: 5px;
        background: rgba(0, 0, 0, 0.4);
        padding: 4px 10px;
        border-radius: 5px;
        white-space: nowrap;
    }
    .penalty-team-display .escudo {
        width: 55px; 
        height: 55px;
    }
    .penalty-balls-container {
        display: flex;
        gap: 8px;
        margin-top: 5px;
    }
    .penalty-ball {
        width: 28px; 
        height: 28px;
        border-radius: 50%;
        border: 2px solid white;
        background-color: transparent;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    .penalty-ball.green { background-color: #28a745; border-color: #28a745; }
    .penalty-ball.red { background-color: #dc3545; border-color: #dc3545; }

    /* Estilos da Animação de GOL! */
    .animated-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 8em; /* Tamanho grande para GOOOOL! */
      font-weight: bold;
      color: #FFD700; /* Cor dourada */
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 10px rgba(0, 0, 0, 0.5);
      z-index: 1001; /* Acima do placar */
      white-space: nowrap;
      pointer-events: none; /* Permite cliques passarem por ele */
      display: none; /* Controlado pela classe .hidden */
    }

    /* Keyframe animations for the GOOOOL! text */
    @keyframes pulse {
        0% { transform: translate(-50%, -50%) scale(1); }
        50% { transform: translate(-50%, -50%) scale(1.05); }
        100% { transform: translate(-50%, -50%) scale(1); }
    }

    @keyframes fadeInOut {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        10% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        90% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(1.2); }
    }

    .placar-main-line.hidden,
    .placar-cards-line.hidden,
    .penalty-shootout-placar.hidden {
        display: none !important;
    }
    
    .animated-text.hidden {
        display: none !important;
    }

  </style>
</head>
<body>
  <div class="visual-overlay-container" id="visualOverlayContainer">
    <div class="placar" id="placarPrincipal">
      <div class="placar-main-line" id="normalPlacarContent">
        <div class="placar-group">
            <div id="cronometro">00:00</div>
        </div>

        <div class="placar-group">
            <img id="escudo1" class="escudo" src="" alt="Escudo Time 1">
            <span id="nomeAbbr1" class="team-name-abbr">T1</span>
            <span id="placar1" class="placar-numero">0</span>
        </div>

        <div class="logo-central">
          <img id="logoOverlay" src="" alt="Sua Logo">
        </div>

        <div class="placar-group">
            <span id="placar2" class="placar-numero">0</span>
            <span id="nomeAbbr2" class="team-name-abbr">T2</span>
            <img id="escudo2" class="escudo" src="" alt="Escudo Time 2">
        </div>
        
        <div class="placar-group">
            <div id="periodoDisplay" class="periodo">1º T</div>
        </div>
      </div>

      <div class="placar-cards-line" id="placarCardsLine">
        <div id="cardsDisplay1" class="cards-display"></div>
        <div id="cardsDisplay2" class="cards-display"></div>
      </div>

      <div class="penalty-shootout-placar" id="penaltyPlacarContent">
        <div class="penalty-team-display">
          <img id="escudoPenalty1" class="escudo" src="" alt="Escudo Time 1">
          <span id="nomePenalty1" class="team-name-display">Time 1</span>
          <div class="penalty-balls-container" id="penaltiesDisplay1"></div>
        </div>
        <div class="logo-central">
          <img id="logoOverlayPenalty" src="" alt="Sua Logo">
        </div>
        <div class="penalty-team-display">
          <img id="escudoPenalty2" class="escudo" src="" alt="Escudo Time 2">
          <span id="nomePenalty2" class="team-name-display">Time 2</span>
          <div class="penalty-balls-container" id="penaltiesDisplay2"></div>
        </div>
      </div>
    </div>
    <div class="animated-text" id="goalAnimation">GOOOOL!</div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // ** SEU FIREBASE CONFIG ESTÁ AQUI **
    const firebaseConfig = {
      apiKey: "AIzaSyAFp_iujrtqjiTU5yq2yNSNSBIpwgjQZZyns",
      authDomain: "aquilesplacarpro.firebaseapp.com",
      databaseURL: "https://aquilesplacarpro-default-rtdb.firebaseio.com",
      projectId: "aquilesplacarpro",
      storageBucket: "aquilesplacarpro.firebasestorage.app",
      messagingSenderId: "922321609151",
      appId: "1:922321609151:web:ba51f5b21b322cf0a4c10a"
    };

    // Inicialize o Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = app.database();
    const overlayStateRef = database.ref('overlayState');

    let timerInterval;

    const placarThemes = [
      { rgb: '34, 34, 34', text: 'white', border: '#555', timerColor: '#0ff' }, 
      { rgb: '0, 123, 255', text: 'white', border: '#0056b3', timerColor: '#fff' },
      { rgb: '40, 167, 69', text: 'white', border: '#218838', timerColor: '#fff' },
      { rgb: '220, 53, 69', text: 'white', border: '#c82333', timerColor: '#fff' },
      { rgb: '255, 193, 7', text: 'black', border: '#e0a800', timerColor: '#333' }
    ];

    const periodNames = {
        0: 'Parado',
        1: '1º T', 
        2: '2º T',
        3: 'Prorrog', 
        4: 'Int', 
        5: 'T. Extra' 
    };

    document.addEventListener('DOMContentLoaded', () => {
        overlayStateRef.on('value', (snapshot) => {
            const overlayState = snapshot.val();
            if (overlayState) {
                renderOverlay(overlayState);
            }
        }, (error) => {
            console.error("Erro ao ler dados do Firebase na overlay:", error);
        });
    });

    function renderOverlay(overlayState) {
      const visualContainer = document.getElementById('visualOverlayContainer');
      const placar1 = document.getElementById('placar1');
      const placar2 = document.getElementById('placar2');
      const nomeAbbr1 = document.getElementById('nomeAbbr1');
      const nomeAbbr2 = document.getElementById('nomeAbbr2');
      const escudo1 = document.getElementById('escudo1');
      const escudo2 = document.getElementById('escudo2');
      const logoOverlay = document.getElementById('logoOverlay');
      const cronometro = document.getElementById('cronometro');
      const periodoDisplay = document.getElementById('periodoDisplay');
      const normalContent = document.getElementById('normalPlacarContent');
      const cardsLine = document.getElementById('placarCardsLine');
      const penaltyContent = document.getElementById('penaltyPlacarContent');
      const goalAnimation = document.getElementById('goalAnimation');
      const escudoPenalty1 = document.getElementById('escudoPenalty1');
      const escudoPenalty2 = document.getElementById('escudoPenalty2');
      const nomePenalty1 = document.getElementById('nomePenalty1');
      const nomePenalty2 = document.getElementById('nomePenalty2');

      // Atualiza visibilidade geral do container
      if (overlayState.isVisible) {
        visualContainer.classList.remove('hidden-display');
      } else {
        visualContainer.classList.add('hidden-display');
      }

      // Atualiza os placares e nomes
      placar1.innerText = overlayState.placar['1'];
      placar2.innerText = overlayState.placar['2'];
      nomeAbbr1.innerText = overlayState.nomeAbbr1 || 'T1';
      nomeAbbr2.innerText = overlayState.nomeAbbr2 || 'T2';

      // Atualiza escudos e logo (com fallback para GIF transparente)
      escudo1.src = overlayState.escudo1 || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
      escudoPenalty1.src = overlayState.escudo1 || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
      escudo2.src = overlayState.escudo2 || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
      escudoPenalty2.src = overlayState.escudo2 || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
      logoOverlay.src = overlayState.logoOverlay || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

      // Atualiza nomes no modo pênalti
      nomePenalty1.innerText = overlayState.nome1 || 'Time 1';
      nomePenalty2.innerText = overlayState.nome2 || 'Time 2';

      // Atualiza cronômetro e período
      cronometro.innerText = formatTime(overlayState.seconds);
      periodoDisplay.innerText = periodNames[overlayState.currentPeriod] || 'N/A';

      // Renderiza cartões
      renderCardsOverlay('1', overlayState.cards['1']);
      renderCardsOverlay('2', overlayState.cards['2']);

      // Renderiza pênaltis
      renderPenaltiesOverlay('1', overlayState.penalties['1']);
      renderPenaltiesOverlay('2', overlayState.penalties['2']);

      // Aplica tema do placar (cores e opacidade)
      applyPlacarThemeOverlay(overlayState.placarThemeIndex, overlayState.placarOpacity);

      // Lógica de visibilidade dos elementos do placar e animação
      // Oculta todos os elementos principais e a animação por padrão
      normalContent.classList.add('hidden');
      cardsLine.classList.add('hidden');
      penaltyContent.classList.add('hidden');
      penaltyContent.classList.remove('active'); // Garante que 'active' seja removido quando oculto
      goalAnimation.classList.add('hidden'); // Garante que o texto GOOOOL! esteja oculto

      // Limpa as animações CSS para permitir que sejam reiniciadas
      goalAnimation.style.animation = '';

      // Determina qual conteúdo deve ser visível
      if (overlayState.activeAnimation === 'goalAnimation') {
          goalAnimation.classList.remove('hidden'); // Mostra o texto GOOOOL!
          // Aplica as animações CSS diretamente quando o estado é ativo
          goalAnimation.style.animation = 'pulse 1.5s infinite alternate, fadeInOut 3.5s forwards'; 
      } else if (overlayState.penaltyModeActive) {
          penaltyContent.classList.remove('hidden');
          penaltyContent.classList.add('active');
      } else {
          normalContent.classList.remove('hidden');
          cardsLine.classList.remove('hidden');
      }

      // Inicia/pausa cronômetro se necessário
      if (overlayState.timerRunning && !timerInterval) {
          startTimerOverlay(overlayState.seconds);
      } else if (!overlayState.timerRunning && timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
      }
    }

    function formatTime(totalSeconds) {
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function applyPlacarThemeOverlay(index, opacity) {
      const theme = placarThemes[index];
      document.documentElement.style.setProperty('--placar-bg-rgb', theme.rgb);
      document.documentElement.style.setProperty('--placar-opacity', (opacity / 100).toFixed(2));
      document.documentElement.style.setProperty('--placar-text', theme.text);
      document.documentElement.style.setProperty('--placar-border', theme.border);
      document.documentElement.style.setProperty('--placar-timer-color', theme.timerColor);
      document.documentElement.style.setProperty('--highlight-color', theme.timerColor);
    }

    function startTimerOverlay(initialSeconds) {
      // Sincroniza o cronômetro com o estado do Firebase
      let currentSeconds = initialSeconds;
      timerInterval = setInterval(() => {
        cronometro.innerText = formatTime(currentSeconds++);
      }, 1000);
    }

    function renderCardsOverlay(time, cardsData) {
        const display = document.getElementById('cardsDisplay' + time);
        display.innerHTML = '';

        for (let i = 0; i < cardsData['amarelo']; i++) {
            const card = document.createElement('div');
            card.classList.add('card-indicator', 'yellow-card');
            display.appendChild(card);
        }
        for (let i = 0; i < cardsData['vermelho']; i++) {
            const card = document.createElement('div');
            card.classList.add('card-indicator', 'red-card');
            display.appendChild(card);
        }
    }

    function renderPenaltiesOverlay(time, penaltiesData) {
        const display = document.getElementById('penaltiesDisplay' + time);
        display.innerHTML = '';

        penaltiesData.forEach(outcome => {
            const ball = document.createElement('div');
            ball.classList.add('penalty-ball');
            if (outcome === 'convertido') {
                ball.classList.add('green');
            } else {
                ball.classList.add('red');
            }
            display.appendChild(ball);
        });
    }
  </script>
</body>
</html>
